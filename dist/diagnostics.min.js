(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var events_1=require("events");var constants_1=require("./constants");var DiagnosticError_1=require("./errors/DiagnosticError");var BitrateTest=function(_super){__extends(BitrateTest,_super);function BitrateTest(options){var _this=_super.call(this)||this;_this._errors=[];_this._lastBytesChecked=0;_this._lastCheckedTimestamp=0;_this._networkTiming={};_this._rtcConfiguration={};_this._testTiming={start:0};_this._totalBytesReceived=0;_this._values=[];options=options||{};_this._rtcConfiguration.iceServers=options.iceServers;_this._pcReceiver=new RTCPeerConnection(_this._rtcConfiguration);_this._pcSender=new RTCPeerConnection(_this._rtcConfiguration);_this._pcReceiver.onicecandidate=function(event){return _this._onIceCandidate(_this._pcSender,event)};_this._pcSender.onicecandidate=function(event){return _this._onIceCandidate(_this._pcReceiver,event)};_this._setupNetworkListeners(_this._pcSender);setTimeout(function(){_this._setupDataChannel();_this._startTest()});return _this}BitrateTest.prototype.stop=function(){clearInterval(this._sendDataIntervalId);clearInterval(this._checkBitrateIntervalId);this._pcSender.close();this._pcReceiver.close();this._testTiming.end=Date.now();this._testTiming.duration=this._testTiming.end-this._testTiming.start;this.emit(BitrateTest.Events.End,this._getReport())};BitrateTest.prototype._checkBitrate=function(){if(!this._lastCheckedTimestamp||!this._lastBytesChecked){this._lastCheckedTimestamp=Date.now();this._lastBytesChecked=this._totalBytesReceived;return}var now=Date.now();var bitrate=8*(this._totalBytesReceived-this._lastBytesChecked)/(now-this._lastCheckedTimestamp);this._lastCheckedTimestamp=now;this._lastBytesChecked=this._totalBytesReceived;this._values.push(bitrate);this.emit(BitrateTest.Events.Bitrate,bitrate)};BitrateTest.prototype._getReport=function(){var averageBitrate=this._values.reduce(function(total,value){return total+=value},0)/this._values.length;return{averageBitrate:isNaN(averageBitrate)?0:averageBitrate,didPass:!this._errors.length&&!!this._values.length,errors:this._errors,networkTiming:this._networkTiming,testName:BitrateTest.testName,testTiming:this._testTiming,values:this._values}};BitrateTest.prototype._onError=function(message,error,isFatal){var diagnosticError=new DiagnosticError_1.DiagnosticError(error,message);this._errors.push(diagnosticError);this.emit(BitrateTest.Events.Error,diagnosticError);if(isFatal){this.stop()}};BitrateTest.prototype._onIceCandidate=function(remotePc,event){var _this=this;if(event.candidate){var candidate=event.candidate.candidate;if(candidate.indexOf("relay")!==-1){remotePc.addIceCandidate(event.candidate).catch(function(error){return _this._onError("Unable to add candidate",error)})}}};BitrateTest.prototype._onMessageReceived=function(event){this._totalBytesReceived+=event.data.length;if(!this._networkTiming.firstPacket){this._networkTiming.firstPacket=Date.now()}};BitrateTest.prototype._onReceiverAnswerCreated=function(answer){var _this=this;return Promise.all([this._pcReceiver.setLocalDescription(answer),this._pcSender.setRemoteDescription(answer)]).catch(function(error){return _this._onError("Unable to set local or remote description from createAnswer",error,true)})};BitrateTest.prototype._onSenderOfferCreated=function(offer){var _this=this;return Promise.all([this._pcSender.setLocalDescription(offer),this._pcReceiver.setRemoteDescription(offer)]).catch(function(error){return _this._onError("Unable to set local or remote description from createOffer",error,true)})};BitrateTest.prototype._sendData=function(){if(!this._rtcDataChannel||this._rtcDataChannel.readyState!=="open"){return}for(var i=0;i<constants_1.MAX_NUMBER_PACKETS;++i){if(this._rtcDataChannel.bufferedAmount>=constants_1.BYTES_KEEP_BUFFERED){break}this._rtcDataChannel.send(constants_1.TEST_PACKET)}};BitrateTest.prototype._setupDataChannel=function(){var _this=this;try{this._rtcDataChannel=this._pcSender.createDataChannel("sender")}catch(e){this._onError("Error creating data channel",e,true);return}this._rtcDataChannel.onopen=function(){_this._sendDataIntervalId=setInterval(function(){return _this._sendData()},1);_this._checkBitrateIntervalId=setInterval(function(){return _this._checkBitrate()},1e3)};this._pcReceiver.ondatachannel=function(dataChannelEvent){dataChannelEvent.channel.onmessage=function(event){return _this._onMessageReceived(event)}}};BitrateTest.prototype._setupNetworkListeners=function(pc){var _this=this;pc.onconnectionstatechange=function(){_this._networkTiming.peerConnection=_this._networkTiming.peerConnection||{start:0};if(pc.connectionState==="connecting"){_this._networkTiming.peerConnection.start=Date.now()}else if(pc.connectionState==="connected"){_this._networkTiming.peerConnection.end=Date.now();var _a=_this._networkTiming.peerConnection,start=_a.start,end=_a.end;_this._networkTiming.peerConnection.duration=end-start}};pc.oniceconnectionstatechange=function(){_this._networkTiming.ice=_this._networkTiming.ice||{start:0};if(pc.iceConnectionState==="checking"){_this._networkTiming.ice.start=Date.now()}else if(pc.iceConnectionState==="connected"){_this._networkTiming.ice.end=Date.now();var _a=_this._networkTiming.ice,start=_a.start,end=_a.end;_this._networkTiming.ice.duration=end-start}}};BitrateTest.prototype._startTest=function(){var _this=this;this._testTiming.start=Date.now();if(!this._rtcConfiguration.iceServers){return this._onError("No iceServers found",undefined,true)}this._pcSender.createOffer().then(function(offer){return _this._onSenderOfferCreated(offer)}).then(function(){return _this._pcReceiver.createAnswer().then(function(answer){return _this._onReceiverAnswerCreated(answer)}).catch(function(error){return _this._onError("Unable to create answer",error,true)})}).catch(function(error){return _this._onError("Unable to create offer",error,true)})};BitrateTest.testName="bitrate-test";return BitrateTest}(events_1.EventEmitter);exports.BitrateTest=BitrateTest;(function(BitrateTest){var Events;(function(Events){Events["Bitrate"]="bitrate";Events["End"]="end";Events["Error"]="error"})(Events=BitrateTest.Events||(BitrateTest.Events={}))})(BitrateTest=exports.BitrateTest||(exports.BitrateTest={}));exports.BitrateTest=BitrateTest;function testBitrate(options){return new BitrateTest(options)}exports.testBitrate=testBitrate},{"./constants":6,"./errors/DiagnosticError":9,events:25}],2:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var events_1=require("events");var constants_1=require("./constants");var errors_1=require("./errors");var polyfills_1=require("./polyfills");var enumerateDevices_1=require("./polyfills/enumerateDevices");var utils_1=require("./utils");var optionValidation_1=require("./utils/optionValidation");var InputTest=function(_super){__extends(InputTest,_super);function InputTest(options){var _this=_super.call(this)||this;_this._audioContext=null;_this._cleanupAudio=null;_this._defaultDevices={};_this._endTime=null;_this._errors=[];_this._maxValue=0;_this._mediaStream=null;_this._values=[];_this._volumeTimeout=null;_this._options=__assign(__assign({},InputTest.defaultOptions),options);setTimeout(function(){return _this._startTest()});return _this}InputTest.prototype.stop=function(pass){if(pass===void 0){pass=true}if(this._endTime){this._onWarning(new errors_1.AlreadyStoppedError);return}this._cleanup();this._endTime=Date.now();var didPass=pass&&!utils_1.detectSilence(this._values);var report={deviceId:this._options.deviceId||this._defaultDevices.audioinput&&this._defaultDevices.audioinput.deviceId,didPass:didPass,errors:this._errors,testName:InputTest.testName,values:this._values};if(this._startTime){report.testTiming={duration:this._endTime-this._startTime,end:this._endTime,start:this._startTime}}this.emit(InputTest.Events.End,didPass,report);return report};Object.defineProperty(InputTest.prototype,"maxVolume",{get:function(){return this._maxValue},enumerable:true,configurable:true});InputTest.prototype._cleanup=function(){if(this._volumeTimeout){clearTimeout(this._volumeTimeout)}if(this._cleanupAudio){this._cleanupAudio()}if(this._mediaStream){this._mediaStream.getTracks().forEach(function(track){return track.stop()})}if(this._audioContext){this._audioContext.close()}};InputTest.prototype._onError=function(error){this._errors.push(error);this.emit(InputTest.Events.Error,error)};InputTest.prototype._onVolume=function(value){if(value>this._maxValue){this._maxValue=value}this._values.push(value);this.emit(InputTest.Events.Volume,value)};InputTest.prototype._onWarning=function(error){if(this._options.debug){console.warn(error)}};InputTest.prototype._startTest=function(){return __awaiter(this,void 0,void 0,function(){var invalidReasons,_a,_b,analyser_1,microphone_1,frequencyDataBytes_1,volumeEvent_1,error_1;var _this=this;return __generator(this,function(_c){switch(_c.label){case 0:_c.trys.push([0,4,,5]);return[4,optionValidation_1.validateOptions(this._options,{deviceId:optionValidation_1.validateDeviceId,duration:optionValidation_1.validateTime,pollIntervalMs:optionValidation_1.validateTime})];case 1:invalidReasons=_c.sent();if(invalidReasons){throw new errors_1.InvalidOptionsError(invalidReasons)}if(!this._options.getUserMedia){throw polyfills_1.GetUserMediaUnsupportedError}_a=this;return[4,this._options.getUserMedia({audio:{deviceId:this._options.deviceId}})];case 2:_a._mediaStream=_c.sent();_b=this;return[4,enumerateDevices_1.getDefaultDevices()];case 3:_b._defaultDevices=_c.sent();this._startTime=Date.now();if(!this._options.audioContextFactory){throw polyfills_1.AudioContextUnsupportedError}this._audioContext=new this._options.audioContextFactory;analyser_1=this._audioContext.createAnalyser();analyser_1.smoothingTimeConstant=.4;analyser_1.fftSize=64;microphone_1=this._audioContext.createMediaStreamSource(this._mediaStream);microphone_1.connect(analyser_1);this._cleanupAudio=function(){analyser_1.disconnect();microphone_1.disconnect()};frequencyDataBytes_1=new Uint8Array(analyser_1.frequencyBinCount);volumeEvent_1=function(){if(_this._endTime){return}analyser_1.getByteFrequencyData(frequencyDataBytes_1);var volume=frequencyDataBytes_1.reduce(function(sum,val){return sum+val},0)/frequencyDataBytes_1.length;_this._onVolume(volume);if(Date.now()-_this._startTime>_this._options.duration){_this.stop()}else{_this._volumeTimeout=setTimeout(volumeEvent_1,_this._options.pollIntervalMs)}};this._volumeTimeout=setTimeout(volumeEvent_1,this._options.pollIntervalMs);return[3,5];case 4:error_1=_c.sent();if(error_1 instanceof errors_1.DiagnosticError){this._onError(error_1)}else if(typeof DOMException!=="undefined"&&error_1 instanceof DOMException){this._onError(new errors_1.DiagnosticError(error_1,"A `DOMException` has occurred."))}else if(typeof DOMError!=="undefined"&&error_1 instanceof DOMError){this._onError(new errors_1.DiagnosticError(error_1,"A `DOMError` has occurred."))}else{this._onError(new errors_1.DiagnosticError(undefined,"Unknown error occurred."));this._onWarning(error_1)}this.stop(false);return[3,5];case 5:return[2]}})})};InputTest.testName=constants_1.TestNames.InputAudioDevice;InputTest.defaultOptions={audioContextFactory:polyfills_1.AudioContext,debug:false,duration:Infinity,enumerateDevices:polyfills_1.enumerateDevices,getUserMedia:polyfills_1.getUserMedia,pollIntervalMs:100};return InputTest}(events_1.EventEmitter);exports.InputTest=InputTest;(function(InputTest){var Events;(function(Events){Events["End"]="end";Events["Error"]="error";Events["Volume"]="volume"})(Events=InputTest.Events||(InputTest.Events={}))})(InputTest=exports.InputTest||(exports.InputTest={}));exports.InputTest=InputTest;function testInputDevice(options){return new InputTest(options)}exports.testInputDevice=testInputDevice},{"./constants":6,"./errors":15,"./polyfills":21,"./polyfills/enumerateDevices":19,"./utils":22,"./utils/optionValidation":23,events:25}],3:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var events_1=require("events");var utils_1=require("../utils");var TestCall=function(_super){__extends(TestCall,_super);function TestCall(config){var _this=_super.call(this)||this;_this._networkTiming={};_this._timeoutDuration=config.timeoutDuration;var peerConnectionFactory=config.peerConnectionFactory||RTCPeerConnection;_this._sender=new peerConnectionFactory(config.peerConnectionConfig);_this._recipient=new peerConnectionFactory(config.peerConnectionConfig);_this._recipient.ondatachannel=function(_a){var channel=_a.channel;channel.onmessage=function(messageEvent){_this.emit(TestCall.Event.Message,messageEvent)};channel.onopen=function(event){_this.emit(TestCall.Event.Open,_this._recipient,event)};channel.onclose=function(event){_this.emit(TestCall.Event.Close,_this._recipient,event)}};_this._sendDataChannel=_this._sender.createDataChannel("sendDataChannel");_this._sendDataChannel.onopen=function(event){_this.emit(TestCall.Event.Open,_this._sender,event)};_this._sendDataChannel.onclose=function(event){_this.emit(TestCall.Event.Close,_this._sender,event)};_this._bindPeerConnectionIceCandidateHandler(_this._sender,_this._recipient);_this._bindPeerConnectionIceCandidateHandler(_this._recipient,_this._sender);_this._bindPeerConnectionTimeHandlers(_this._sender);return _this}TestCall.prototype.close=function(){if(this._sender){this._sender.close()}if(this._recipient){this._recipient.close()}};TestCall.prototype.establishConnection=function(){return __awaiter(this,void 0,void 0,function(){var waitForDataChannelOpen,senderDesc,recipientDesc;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:waitForDataChannelOpen=[this._sender,this._recipient].map(function(peerConnection){return new Promise(function(resolve){_this.on(TestCall.Event.Open,function(connectedPeerConnection){if(peerConnection===connectedPeerConnection){resolve()}})})});return[4,this._sender.createOffer()];case 1:senderDesc=_a.sent();return[4,Promise.all([this._sender.setLocalDescription(senderDesc),this._recipient.setRemoteDescription(senderDesc)])];case 2:_a.sent();return[4,this._recipient.createAnswer()];case 3:recipientDesc=_a.sent();return[4,Promise.all([this._recipient.setLocalDescription(recipientDesc),this._sender.setRemoteDescription(recipientDesc)])];case 4:_a.sent();return[4,Promise.all(waitForDataChannelOpen.map(function(promise){return utils_1.waitForPromise(promise,_this._timeoutDuration)}))];case 5:_a.sent();return[2]}})})};TestCall.prototype.getNetworkTiming=function(){return this._networkTiming};TestCall.prototype.send=function(data){this._sendDataChannel.send(data)};TestCall.prototype._bindPeerConnectionIceCandidateHandler=function(peerConnectionFrom,peerConnectionTo){var _this=this;peerConnectionFrom.onicecandidate=function(iceEvent){if(iceEvent.candidate&&iceEvent.candidate.candidate&&iceEvent.candidate.candidate.indexOf("relay")!==-1){_this.emit(TestCall.Event.IceCandidate,peerConnectionFrom,iceEvent);peerConnectionTo.addIceCandidate(iceEvent.candidate)}}};TestCall.prototype._bindPeerConnectionTimeHandlers=function(peerConnection){var _this=this;peerConnection.onconnectionstatechange=function(){_this._networkTiming.peerConnection=_this._networkTiming.peerConnection||{start:0};switch(peerConnection.connectionState){case"connecting":_this._networkTiming.peerConnection.start=Date.now();break;case"connected":_this._networkTiming.peerConnection.end=Date.now();_this._networkTiming.peerConnection.duration=_this._networkTiming.peerConnection.end-_this._networkTiming.peerConnection.start;break}};peerConnection.oniceconnectionstatechange=function(){_this._networkTiming.ice=_this._networkTiming.ice||{start:0};switch(peerConnection.iceConnectionState){case"checking":_this._networkTiming.ice.start=Date.now();break;case"connected":_this._networkTiming.ice.end=Date.now();_this._networkTiming.ice.duration=_this._networkTiming.ice.end-_this._networkTiming.ice.start;break}}};return TestCall}(events_1.EventEmitter);exports.TestCall=TestCall;(function(TestCall){var Event;(function(Event){Event["Close"]="close";Event["IceCandidate"]="iceCandidate";Event["Message"]="message";Event["Open"]="open"})(Event=TestCall.Event||(TestCall.Event={}));var CallId;(function(CallId){CallId["Recipient"]="recipient";CallId["Sender"]="sender"})(CallId=TestCall.CallId||(TestCall.CallId={}))})(TestCall=exports.TestCall||(exports.TestCall={}));exports.TestCall=TestCall},{"../utils":22,events:25}],4:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var events_1=require("events");var errors_1=require("../errors");var NetworkInformation_1=require("../polyfills/NetworkInformation");var utils_1=require("../utils");var optionValidation_1=require("../utils/optionValidation");var TestCall_1=require("./TestCall");var NetworkTest=function(_super){__extends(NetworkTest,_super);function NetworkTest(options){var _this=_super.call(this)||this;_this._endTime=null;_this._errors=[];_this._networkTiming={};_this._testCall=null;_this._options=__assign(__assign({},NetworkTest.defaultOptions),options);_this._startTime=Date.now();_this._peerConnectionConfig={iceServers:_this._options.iceServers};setTimeout(function(){return _this._startTest()});return _this}NetworkTest.prototype._determinePass=function(){return this._errors.length===0};NetworkTest.prototype._onError=function(error){this._errors.push(error);this.emit(NetworkTest.Events.Error,error)};NetworkTest.prototype._startTest=function(){return __awaiter(this,void 0,void 0,function(){var waitReceivedMessage_1,error_1,error_2;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,6,,7]);return[4,optionValidation_1.validateOptions(this._options,{timeoutMs:optionValidation_1.validateTime})];case 1:_a.sent();this._testCall=new TestCall_1.TestCall({peerConnectionConfig:this._peerConnectionConfig,peerConnectionFactory:this._options.peerConnectionFactory,timeoutDuration:this._options.timeoutMs});waitReceivedMessage_1=new Promise(function(resolve,reject){if(!_this._testCall){reject(new errors_1.InvalidStateError("TestCall is `null`."));return}_this._testCall.on(TestCall_1.TestCall.Event.Message,function(message){if(message.data===NetworkTest.testMessage){_this._networkTiming.firstPacket=Date.now();resolve()}})});_a.label=2;case 2:_a.trys.push([2,4,,5]);return[4,utils_1.waitForPromise(function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:if(!this._testCall){throw new errors_1.InvalidStateError("TestCall is `null`.")}return[4,this._testCall.establishConnection()];case 1:_a.sent();this._testCall.send(NetworkTest.testMessage);return[4,waitReceivedMessage_1];case 2:_a.sent();return[2]}})})}(),this._options.timeoutMs)];case 3:_a.sent();return[3,5];case 4:error_1=_a.sent();if(error_1 instanceof errors_1.PromiseTimedOutError){throw new errors_1.DiagnosticError(undefined,"NetworkTest timeout, the PeerConnection did not receive the "+"message.")}else{throw error_1}return[3,5];case 5:this._stop(true);return[3,7];case 6:error_2=_a.sent();if(error_2 instanceof errors_1.DiagnosticError){this._onError(error_2)}else if(typeof DOMException!=="undefined"&&error_2 instanceof DOMException){this._onError(new errors_1.DiagnosticError(error_2,"A `DOMException` occurred."))}else if(typeof DOMError!=="undefined"&&error_2 instanceof DOMError){this._onError(new errors_1.DiagnosticError(error_2,"A `DOMError` occurred."))}else{this._onError(error_2)}this._stop(false);return[3,7];case 7:return[2]}})})};NetworkTest.prototype._stop=function(didPass){if(didPass===void 0){didPass=true}if(this._testCall){this._testCall.close()}var info=this._options.networkInformation||{};this._endTime=Date.now();var testCallNetworkTiming=this._testCall?this._testCall.getNetworkTiming():{};var report={didPass:didPass&&this._determinePass(),downlink:info.downlink,downlinkMax:info.downlinkMax,effectiveType:info.effectiveType,errors:this._errors,networkTiming:__assign(__assign({},this._networkTiming),testCallNetworkTiming),rtt:info.rtt,saveData:info.saveData,testName:NetworkTest.testName,testTiming:{duration:this._endTime-this._startTime,end:this._endTime,start:this._startTime},type:info.type};this.emit(NetworkTest.Events.End,report)};NetworkTest.testMessage="Ahoy, world!";NetworkTest.testName="network-connectivity";NetworkTest.defaultOptions={networkInformation:NetworkInformation_1.networkInformationPolyfill,timeoutMs:5e3};return NetworkTest}(events_1.EventEmitter);exports.NetworkTest=NetworkTest;(function(NetworkTest){var Events;(function(Events){Events["End"]="end";Events["Error"]="error"})(Events=NetworkTest.Events||(NetworkTest.Events={}))})(NetworkTest=exports.NetworkTest||(exports.NetworkTest={}));exports.NetworkTest=NetworkTest;function testNetwork(options){return new NetworkTest(options)}exports.testNetwork=testNetwork},{"../errors":15,"../polyfills/NetworkInformation":18,"../utils":22,"../utils/optionValidation":23,"./TestCall":3,events:25}],5:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var events_1=require("events");var constants_1=require("./constants");var errors_1=require("./errors");var polyfills_1=require("./polyfills");var enumerateDevices_1=require("./polyfills/enumerateDevices");var utils_1=require("./utils");var optionValidation_1=require("./utils/optionValidation");var OutputTest=function(_super){__extends(OutputTest,_super);function OutputTest(options){var _this=_super.call(this)||this;_this._audioContext=null;_this._audioElement=null;_this._defaultDevices={};_this._endTime=null;_this._errors=[];_this._playPromise=null;_this._values=[];_this._volumeTimeout=null;_this._options=__assign(__assign({},OutputTest.defaultOptions),options);_this._startTime=Date.now();setTimeout(function(){return _this._startTest()});return _this}OutputTest.prototype.stop=function(pass){if(pass===void 0){pass=true}if(this._endTime){this._onWarning(new errors_1.AlreadyStoppedError);return}this._cleanup();this._endTime=Date.now();var report={deviceId:this._options.deviceId||this._defaultDevices.audiooutput&&this._defaultDevices.audiooutput.deviceId,didPass:pass&&!utils_1.detectSilence(this._values),errors:this._errors,testName:OutputTest.testName,testTiming:{duration:this._endTime-this._startTime,end:this._endTime,start:this._startTime},testURI:this._options.testURI,values:this._values};this.emit(OutputTest.Events.End,report.didPass,report);return report};OutputTest.prototype._cleanup=function(){var _this=this;if(this._volumeTimeout){clearTimeout(this._volumeTimeout)}if(this._audioContext){this._audioContext.close()}if(this._playPromise){this._playPromise.then(function(){if(_this._audioElement){_this._audioElement.pause()}}).catch(function(){})}};OutputTest.prototype._onError=function(error){this._errors.push(error);this.emit(OutputTest.Events.Error,error)};OutputTest.prototype._onVolume=function(volume){this._values.push(volume);this.emit(OutputTest.Events.Volume,volume)};OutputTest.prototype._onWarning=function(error){if(this._options.debug){console.warn(error)}};OutputTest.prototype._startTest=function(){return __awaiter(this,void 0,void 0,function(){var invalidReasons,source,analyser_1,frequencyDataBytes_1,volumeEvent_1,_a,error_1;var _this=this;return __generator(this,function(_b){switch(_b.label){case 0:_b.trys.push([0,7,,8]);return[4,optionValidation_1.validateOptions(this._options,{deviceId:optionValidation_1.validateDeviceId,duration:optionValidation_1.validateTime,pollIntervalMs:optionValidation_1.validateTime})];case 1:invalidReasons=_b.sent();if(invalidReasons){throw new errors_1.InvalidOptionsError(invalidReasons)}if(!this._options.audioContextFactory){throw polyfills_1.AudioContextUnsupportedError}this._audioContext=new this._options.audioContextFactory;if(!this._options.audioElementFactory){throw polyfills_1.AudioUnsupportedError}this._audioElement=new this._options.audioElementFactory(this._options.testURI);this._audioElement.setAttribute("crossorigin","anonymous");this._audioElement.loop=!!this._options.doLoop;if(!this._options.deviceId)return[3,4];if(!this._audioElement.setSinkId)return[3,3];return[4,this._audioElement.setSinkId(this._options.deviceId)];case 2:_b.sent();return[3,4];case 3:this._onError(new errors_1.UnsupportedError("A `deviceId` was passed to the `OutputTest` but `setSinkId` is "+"not supported in this browser."));_b.label=4;case 4:source=this._audioContext.createMediaElementSource(this._audioElement);source.connect(this._audioContext.destination);analyser_1=this._audioContext.createAnalyser();analyser_1.smoothingTimeConstant=.4;analyser_1.fftSize=64;source.connect(analyser_1);frequencyDataBytes_1=new Uint8Array(analyser_1.frequencyBinCount);volumeEvent_1=function(){if(_this._endTime){return}analyser_1.getByteFrequencyData(frequencyDataBytes_1);var volume=frequencyDataBytes_1.reduce(function(sum,val){return sum+val},0)/frequencyDataBytes_1.length;_this._onVolume(volume);var isTimedOut=Date.now()-_this._startTime>_this._options.duration;var stop=_this._options.doLoop?isTimedOut:_this._audioElement&&_this._audioElement.ended||isTimedOut;if(stop){if(_this._options.passOnTimeout===false){_this._onError(new errors_1.DiagnosticError(undefined,"Test timed out."))}_this.stop(_this._options.passOnTimeout)}else{_this._volumeTimeout=setTimeout(volumeEvent_1,_this._options.pollIntervalMs)}};this._playPromise=this._audioElement.play();return[4,this._playPromise];case 5:_b.sent();_a=this;return[4,enumerateDevices_1.getDefaultDevices()];case 6:_a._defaultDevices=_b.sent();this._volumeTimeout=setTimeout(volumeEvent_1,this._options.pollIntervalMs);return[3,8];case 7:error_1=_b.sent();if(error_1 instanceof errors_1.DiagnosticError){this._onError(error_1)}else if(typeof DOMException!=="undefined"&&error_1 instanceof DOMException){this._onError(new errors_1.DiagnosticError(error_1,"A DOMException has occurred."))}else if(typeof DOMError!=="undefined"&&error_1 instanceof DOMError){this._onError(new errors_1.DiagnosticError(error_1,"A DOMError has occurred."))}else{this._onError(new errors_1.DiagnosticError(undefined,"Unknown error occurred."));this._onWarning(error_1)}this.stop(false);return[3,8];case 8:return[2]}})})};OutputTest.testName=constants_1.TestNames.OutputAudioDevice;OutputTest.defaultOptions={audioContextFactory:polyfills_1.AudioContext,audioElementFactory:polyfills_1.Audio,debug:false,doLoop:true,duration:Infinity,enumerateDevices:polyfills_1.enumerateDevices,passOnTimeout:true,pollIntervalMs:100,testURI:constants_1.INCOMING_SOUND_URL};return OutputTest}(events_1.EventEmitter);exports.OutputTest=OutputTest;(function(OutputTest){var Events;(function(Events){Events["End"]="end";Events["Error"]="error";Events["Volume"]="volume"})(Events=OutputTest.Events||(OutputTest.Events={}))})(OutputTest=exports.OutputTest||(exports.OutputTest={}));exports.OutputTest=OutputTest;function testOutputDevice(options){return new OutputTest(options)}exports.testOutputDevice=testOutputDevice},{"./constants":6,"./errors":15,"./polyfills":21,"./polyfills/enumerateDevices":19,"./utils":22,"./utils/optionValidation":23,events:25}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var pack=require("../package.json");exports.MAX_NUMBER_PACKETS=100;exports.BYTES_KEEP_BUFFERED=1024*exports.MAX_NUMBER_PACKETS;exports.TEST_PACKET=Array(1024).fill("h").join("");exports.INCOMING_SOUND_URL="https://sdk.twilio.com/js/client/sounds/releases/1.0.0/incoming.mp3?cache="+pack.name+"+"+pack.version;var TestNames;(function(TestNames){TestNames["InputAudioDevice"]="input-volume";TestNames["OutputAudioDevice"]="output-volume"})(TestNames=exports.TestNames||(exports.TestNames={}))},{"../package.json":24}],7:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:true});var BitrateTest_1=require("./BitrateTest");var InputTest_1=require("./InputTest");var NetworkTest_1=require("./NetworkTest");var OutputTest_1=require("./OutputTest");window.Twilio=window.Twilio||{};window.Twilio.Diagnostics=__assign(__assign({},window.Twilio.Diagnostics),{testBitrate:BitrateTest_1.testBitrate,testInputDevice:InputTest_1.testInputDevice,testNetwork:NetworkTest_1.testNetwork,testOutputDevice:OutputTest_1.testOutputDevice})},{"./BitrateTest":1,"./InputTest":2,"./NetworkTest":4,"./OutputTest":5}],8:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var InvalidStateError_1=require("./InvalidStateError");var AlreadyStoppedError=function(_super){__extends(AlreadyStoppedError,_super);function AlreadyStoppedError(){var _this=_super.call(this,"This test already has a defined end timestamp. "+"Tests should not be run multiple times, instead start a new one.")||this;_this.name="AlreadyStoppedError";return _this}return AlreadyStoppedError}(InvalidStateError_1.InvalidStateError);exports.AlreadyStoppedError=AlreadyStoppedError},{"./InvalidStateError":12}],9:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var DiagnosticError=function(_super){__extends(DiagnosticError,_super);function DiagnosticError(domError,message){var _this=_super.call(this,message)||this;_this.timestamp=Date.now();_this.domError=domError;Object.setPrototypeOf(_this,DiagnosticError.prototype);_this.name="DiagnosticError";return _this}return DiagnosticError}(Error);exports.DiagnosticError=DiagnosticError},{}],10:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var DiagnosticError_1=require("./DiagnosticError");var InvalidOptionError=function(_super){__extends(InvalidOptionError,_super);function InvalidOptionError(option,reason,error){var _this=this;var domError=typeof DOMError!=="undefined"&&error instanceof DOMError||typeof DOMException!=="undefined"&&error instanceof DOMException?error:undefined;_this=_super.call(this,domError,'Option "'+option+'" invalid with reason: "'+reason+'".')||this;_this.option=option;_this.reason=reason;_this.error=error;_this.name="InvalidOptionError";return _this}return InvalidOptionError}(DiagnosticError_1.DiagnosticError);exports.InvalidOptionError=InvalidOptionError},{"./DiagnosticError":9}],11:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var DiagnosticError_1=require("./DiagnosticError");var InvalidOptionsError=function(_super){__extends(InvalidOptionsError,_super);function InvalidOptionsError(reasons){var _this=_super.call(this,undefined,"Some of the options passed to this test were unable to be validated.")||this;_this.reasons={};_this.reasons=reasons;_this.name="InvalidOptionsError";return _this}return InvalidOptionsError}(DiagnosticError_1.DiagnosticError);exports.InvalidOptionsError=InvalidOptionsError},{"./DiagnosticError":9}],12:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var DiagnosticError_1=require("./DiagnosticError");var InvalidStateError=function(_super){__extends(InvalidStateError,_super);function InvalidStateError(message){var _this=_super.call(this,undefined,message)||this;_this.name="InvalidStateError";return _this}return InvalidStateError}(DiagnosticError_1.DiagnosticError);exports.InvalidStateError=InvalidStateError},{"./DiagnosticError":9}],13:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var PromiseTimedOutError=function(_super){__extends(PromiseTimedOutError,_super);function PromiseTimedOutError(){var _this=_super.call(this)||this;Object.setPrototypeOf(_this,PromiseTimedOutError.prototype);return _this}return PromiseTimedOutError}(Error);exports.PromiseTimedOutError=PromiseTimedOutError},{}],14:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var DiagnosticError_1=require("./DiagnosticError");var UnsupportedError=function(_super){__extends(UnsupportedError,_super);function UnsupportedError(message){var _this=_super.call(this,undefined,message)||this;_this.name="UnsupportedError";return _this}return UnsupportedError}(DiagnosticError_1.DiagnosticError);exports.UnsupportedError=UnsupportedError},{"./DiagnosticError":9}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AlreadyStoppedError_1=require("./AlreadyStoppedError");exports.AlreadyStoppedError=AlreadyStoppedError_1.AlreadyStoppedError;var DiagnosticError_1=require("./DiagnosticError");exports.DiagnosticError=DiagnosticError_1.DiagnosticError;var InvalidStateError_1=require("./InvalidStateError");exports.InvalidStateError=InvalidStateError_1.InvalidStateError;var PromiseTimedOutError_1=require("./PromiseTimedOutError");exports.PromiseTimedOutError=PromiseTimedOutError_1.PromiseTimedOutError;var UnsupportedError_1=require("./UnsupportedError");exports.UnsupportedError=UnsupportedError_1.UnsupportedError;var InvalidOptionError_1=require("./InvalidOptionError");exports.InvalidOptionError=InvalidOptionError_1.InvalidOptionError;var InvalidOptionsError_1=require("./InvalidOptionsError");exports.InvalidOptionsError=InvalidOptionsError_1.InvalidOptionsError},{"./AlreadyStoppedError":8,"./DiagnosticError":9,"./InvalidOptionError":10,"./InvalidOptionsError":11,"./InvalidStateError":12,"./PromiseTimedOutError":13,"./UnsupportedError":14}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errors_1=require("../errors");exports.AudioUnsupportedError=new errors_1.UnsupportedError("The `HTMLAudioElement` constructor `Audio` is not supported.");exports.AudioPolyfill=typeof window!=="undefined"?window.Audio:undefined},{"../errors":15}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errors_1=require("../errors");exports.AudioContextUnsupportedError=new errors_1.UnsupportedError("AudioContext is not supported by this browser.");exports.AudioContextPolyfill=typeof window!=="undefined"?window.AudioContext||window.webkitAudioContext:undefined},{"../errors":15}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var polyfillWindow=typeof window!=="undefined"?window:undefined;exports.networkInformationPolyfill=typeof polyfillWindow!=="undefined"&&polyfillWindow.navigator&&polyfillWindow.navigator.connection?polyfillWindow.navigator.connection:undefined},{}],19:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var errors_1=require("../errors");exports.enumerateDevicesUnsupportedMessage="The function `enumerateDevices` is not supported.";exports.EnumerateDevicesUnsupportedError=new errors_1.UnsupportedError(exports.enumerateDevicesUnsupportedMessage);exports.enumerateDevicesPolyfill=typeof navigator!=="undefined"&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices):undefined;function getDefaultDevices(){return __awaiter(this,void 0,void 0,function(){var defaultDeviceIds,_i,_a,device;return __generator(this,function(_b){switch(_b.label){case 0:defaultDeviceIds={};if(!exports.enumerateDevicesPolyfill)return[3,4];_i=0;return[4,exports.enumerateDevicesPolyfill()];case 1:_a=_b.sent().reverse();_b.label=2;case 2:if(!(_i<_a.length))return[3,4];device=_a[_i];defaultDeviceIds[device.kind]=device;_b.label=3;case 3:_i++;return[3,2];case 4:return[2,defaultDeviceIds]}})})}exports.getDefaultDevices=getDefaultDevices},{"../errors":15}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errors_1=require("../errors");exports.GetUserMediaUnsupportedError=new errors_1.UnsupportedError("The function `getUserMedia` is not supported.");exports.getUserMediaPolyfill=typeof window!=="undefined"&&window.navigator!==undefined&&window.navigator.mediaDevices!==undefined&&window.navigator.mediaDevices.getUserMedia!==undefined?window.navigator.mediaDevices.getUserMedia.bind(window.navigator.mediaDevices):undefined},{"../errors":15}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Audio_1=require("./Audio");exports.Audio=Audio_1.AudioPolyfill;exports.AudioUnsupportedError=Audio_1.AudioUnsupportedError;var AudioContext_1=require("./AudioContext");exports.AudioContext=AudioContext_1.AudioContextPolyfill;exports.AudioContextUnsupportedError=AudioContext_1.AudioContextUnsupportedError;var enumerateDevices_1=require("./enumerateDevices");exports.enumerateDevices=enumerateDevices_1.enumerateDevicesPolyfill;exports.enumerateDevicesUnsupportedMessage=enumerateDevices_1.enumerateDevicesUnsupportedMessage;exports.EnumerateDevicesUnsupportedError=enumerateDevices_1.EnumerateDevicesUnsupportedError;var getUserMedia_1=require("./getUserMedia");exports.getUserMedia=getUserMedia_1.getUserMediaPolyfill;exports.GetUserMediaUnsupportedError=getUserMedia_1.GetUserMediaUnsupportedError;var NetworkInformation_1=require("./NetworkInformation");exports.networkInformation=NetworkInformation_1.networkInformationPolyfill},{"./Audio":16,"./AudioContext":17,"./NetworkInformation":18,"./enumerateDevices":19,"./getUserMedia":20}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errors_1=require("../errors");function detectSilence(volumes){return!(volumes&&volumes.length>3&&volumes.filter(function(v){return v>0}).length/volumes.length>.5)}exports.detectSilence=detectSilence;function waitForPromise(promise,timeoutMs){var timer;var timeoutPromise=new Promise(function(_,reject){timer=setTimeout(function(){return reject(new errors_1.PromiseTimedOutError)},timeoutMs)});return Promise.race([promise,timeoutPromise]).finally(function(){clearTimeout(timer)})}exports.waitForPromise=waitForPromise},{"../errors":15}],23:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var polyfills_1=require("../polyfills");function createAudioDeviceValidator(options){var _this=this;if(options===void 0){options={}}var opts=__assign({enumerateDevices:polyfills_1.enumerateDevices},options);return function(deviceId){return __awaiter(_this,void 0,void 0,function(){var devices,_a,matchingDevicesKind,matchingDevicesId,matchingDevicesIdAndKind;return __generator(this,function(_b){switch(_b.label){case 0:_a=opts.enumerateDevices;if(!_a)return[3,2];return[4,opts.enumerateDevices()];case 1:_a=_b.sent();_b.label=2;case 2:devices=_a;if(!devices){throw polyfills_1.EnumerateDevicesUnsupportedError}if(!devices.length){return[2,"No audio devices available."]}if(deviceId===undefined){if(opts.kind){matchingDevicesKind=devices.filter(function(device){return device.kind===opts.kind});if(!matchingDevicesKind.length){return[2,'No devices found with the correct kind "'+opts.kind+'".']}}return[2]}matchingDevicesId=devices.filter(function(device){return device.deviceId===deviceId});if(!matchingDevicesId.length){return[2,'Device ID "'+deviceId+'" not found within list of available devices.']}if(opts.kind){matchingDevicesIdAndKind=matchingDevicesId.filter(function(device){return device.kind===opts.kind});if(!matchingDevicesIdAndKind.length){return[2,'Device ID "'+deviceId+'" is not the correct "kind",'+(' expected "'+opts.kind+'".')]}}return[2]}})})}}exports.createAudioDeviceValidator=createAudioDeviceValidator;function validateDeviceId(option){if(option&&typeof option!=="string"){return'If "deviceId" is defined, it must be a "string".'}}exports.validateDeviceId=validateDeviceId;function validateString(option){var type=typeof option;if(type!=="string"){return'Option cannot have type "'+type+'", must be "string".'}}exports.validateString=validateString;function validateTime(option){var doesNotExistMessage=validateExists(option);if(doesNotExistMessage){return doesNotExistMessage}if(typeof option!=="number"){return"Time must be a number."}if(option<0){return"Time must always be non-negative."}}exports.validateTime=validateTime;function validateExists(option){if(option===undefined||option===null){return'Option cannot be "'+String(option)+'".'}}exports.validateExists=validateExists;function validateOptions(inputOptions,config){return __awaiter(this,void 0,void 0,function(){var validity;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:validity={};return[4,Promise.all(Object.entries(config).map(function(_a){var optionKey=_a[0],validatorFunctions=_a[1];return __awaiter(_this,void 0,void 0,function(){var optionValue,validators;var _this=this;return __generator(this,function(_b){switch(_b.label){case 0:if(!validatorFunctions){return[2]}optionValue=inputOptions[optionKey];validators=Array.isArray(validatorFunctions)?validatorFunctions:[validatorFunctions];return[4,Promise.all(validators.map(function(validator){return __awaiter(_this,void 0,void 0,function(){var invalidReason,invalidReasons;return __generator(this,function(_a){switch(_a.label){case 0:return[4,validator(optionValue)];case 1:invalidReason=_a.sent();if(invalidReason){invalidReasons=validity[optionKey];if(invalidReasons){invalidReasons.push(invalidReason)}else{validity[optionKey]=[invalidReason]}}return[2]}})})}))];case 1:_b.sent();return[2]}})})}))];case 1:_a.sent();if(Object.keys(validity).length){return[2,validity]}return[2]}})})}exports.validateOptions=validateOptions},{"../polyfills":21}],24:[function(require,module,exports){module.exports={name:"twilio-diagnostics",version:"0.0.2-rc1",description:"Various diagnostics functions to help analyze connections to Twilio",main:"./es5/lib/diagnostics.js",scripts:{build:"npm-run-all clean docs build:es5 build:dist build:dist-min","build:dist":"rimraf ./dist && node ./scripts/build.js ./LICENSE.md ./dist/diagnostics.js","build:dist-min":'uglifyjs ./dist/diagnostics.js -o ./dist/diagnostics.min.js --comments "/^! diagnostics.js/" -b beautify=false,ascii_only=true',"build:es5":"rimraf ./es5 && tsc","build:release":"npm-run-all lint build status",clean:"rimraf ./dist ./coverage ./es5 ./docs",docs:"rimraf ./docs && typedoc --internal-aliases internal,publicapi --external-aliases external,internalapi --excludePrivate --excludeProtected --theme ./node_modules/typedoc-twilio-theme/bin/default",lint:"tslint -c ./tslint.json --project ./tsconfig.json -t stylish",release:"release",status:"git status",test:"npm-run-all lint build test:unit test:integration","test:unit":"nyc mocha -r ts-node/register ./tests/unit/index.ts","test:integration":"karma start"},contributors:["Michael Huynh","Ryan Rowland","Charlie Santos"],license:"Apache-2.0",keywords:["client","diagnostics","twilio","video","voice","voip"],private:true,dependencies:{"@types/events":"3.0.0","@types/node":"12.12.11",events:"3.0.0"},devDependencies:{"@types/mocha":"5.2.7","@types/sinon":"7.5.1",browserify:"16.5.0",coverage:"0.4.1","is-docker":"2.0.0",karma:"4.4.1","karma-chrome-launcher":"3.1.0","karma-firefox-launcher":"1.2.0","karma-mocha":"1.3.0","karma-spec-reporter":"0.0.32","karma-typescript":"4.1.1",mocha:"6.2.2","npm-run-all":"4.1.5",nyc:"15.0.0","release-tool":"git://github.com/twilio/release-tool#8860ca9",sinon:"7.5.0","travis-multirunner":"4.6.0","ts-node":"8.5.2",tsify:"4.0.1",tslint:"5.20.1",twilio:"3.39.1",typedoc:"0.16.11","typedoc-plugin-as-member-of":"1.0.2","typedoc-plugin-external-module-name":"3.0.0","typedoc-plugin-internal-external":"2.1.1","typedoc-twilio-theme":"github:charliesantos/typedoc-twilio-theme#1.0.1",typescript:"3.7.2","vinyl-fs":"3.0.3","vinyl-source-stream":"2.0.0"}}},{}],25:[function(require,module,exports){var objectCreate=Object.create||objectCreatePolyfill;var objectKeys=Object.keys||objectKeysPolyfill;var bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){if(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events")){this._events=objectCreate(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;var hasDefineProperty;try{var o={};if(Object.defineProperty)Object.defineProperty(o,"x",{value:0});hasDefineProperty=o.x===0}catch(err){hasDefineProperty=false}if(hasDefineProperty){Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=="number"||arg<0||arg!==arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}})}else{EventEmitter.defaultMaxListeners=defaultMaxListeners}EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};function emitNone(handler,isFn,self){if(isFn)handler.call(self);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self)}}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1)}}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].apply(self,args)}}EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events;var doError=type==="error";events=this._events;if(events)doError=doError&&events.error==null;else if(!doError)return false;if(doError){if(arguments.length>1)er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Unhandled "error" event. ('+er+")");err.context=er;throw err}return false}handler=events[type];if(!handler)return false;var isFn=typeof handler==="function";len=arguments.length;switch(len){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=target._events;if(!events){events=target._events=objectCreate(null);target._eventsCount=0}else{if(events.newListener){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(!existing){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else{if(prepend){existing.unshift(listener)}else{existing.push(listener)}}if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners '+"added. Use emitter.setMaxListeners() to "+"increase limit.");w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;if(typeof console==="object"&&console.warn){console.warn("%s: %s",w.name,w.message)}}}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;switch(arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:var args=new Array(arguments.length);for(var i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=bind.call(onceWrapper,state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=this._events;if(!events)return this;list=events[type];if(!list)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=objectCreate(null);else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(position===0)list.shift();else spliceOne(list,position);if(list.length===1)events[type]=list[0];if(events.removeListener)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(!events)return this;if(!events.removeListener){if(arguments.length===0){this._events=objectCreate(null);this._eventsCount=0}else if(events[type]){if(--this._eventsCount===0)this._events=objectCreate(null);else delete events[type]}return this}if(arguments.length===0){var keys=objectKeys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=objectCreate(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}return this};function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];if(!evlistener)return[];if(typeof evlistener==="function")return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i)copy[i]=arr[i];return copy}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}function objectCreatePolyfill(proto){var F=function(){};F.prototype=proto;return new F}function objectKeysPolyfill(obj){var keys=[];for(var k in obj)if(Object.prototype.hasOwnProperty.call(obj,k)){keys.push(k)}return k}function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}},{}]},{},[7]);